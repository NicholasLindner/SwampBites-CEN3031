{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<!DOCTYPE html>
<html>
<head>
    <style>
        table {
            border-collapse: collapse;
            background: white;
            color: black;
            border: 1px solid black;
            width: 100%;
            table-layout: fixed;
            height: 55vh;
        }
         
        th, td {
            border: 1px solid black;
            text-align: left;
            padding: 8px;
            vertical-align: top;
            width: 10%
        }

        td:hover {background-color: lightcyan;}

        .highlight {
            background-color: #FFD700; /* Gold background for today's date */
        }

        .highlight:hover {
            background-color: #EFF37F;
        }

        .selected {
            background-color: rgb(255, 252, 234);
        }

        .selected:hover {
            background-color: rgb(248, 255, 230);
        }

        .month-year-buttons {
            margin-top: 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .calendar-container {
            padding-top: 10px;
        }

        .table-header {
            height: 10px;
            background: orange;
            color: black;
        }

        .date-number {
            position: relative;
            top: 0;
            left: 0;
            padding: 5px;
            font-weight: bold;
        }

        .num-shifts {
            position: relative;
            bottom: 0;
            right: 0;
            padding: 5px;
        }

        .shift-buttons {
            position: absolute;
            right: 40px;
            bottom: 40px;
            height: 7%;
            width:10%;

            background-color: #1a91e0;
            color: white;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="monthYear" class="text-center font-weight-bold month-year-buttons">
            <button onclick="changeMonth(-1)" id="prev">&#10094;</button>
            <span style="font-size: 24px;">Month / Year</span>
            <button onclick="changeMonth(1)" id="next">&#10095;</button>
        </div>
        <div class="calendar-container">
            <table>
                <thead>
                    <tr class="table-header">
                        <th>Sun</th>
                        <th>Mon</th>
                        <th>Tue</th>
                        <th>Wed</th>
                        <th>Thu</th>
                        <th>Fri</th>
                        <th>Sat</th>
                    </tr>
                </thead>
                <tbody id="calendarBody">
                    <!-- Calendar days will be generated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    <div id="shift-buttons" class="text-center font-weight-bold">
        <button class="shift-buttons" onclick="addShift()" >Add Shift</button>
    </div>
</body>
</html>

{% endblock %}

{% block javascript %}
<script>
    const today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();

    const months = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];

    document.addEventListener("DOMContentLoaded", function() {
        renderCalendar(currentMonth, currentYear);
    });

    let shifts = [];

    function changeMonth(direction) {
        currentMonth += direction;
        if (currentMonth < 0 || currentMonth > 11) {
            currentMonth -= direction; // Prevents moving outside the current year
        }
        renderCalendar(currentMonth, currentYear);
    }

    function addShift() {
        let cells = document.getElementById("calendarBody").getElementsByClassName("selected");
        if (cells.length > 0) {
            cell = cells[0];
            let month = JSON.parse(cell.dataset.month);
            let date = JSON.parse(cell.dataset.date);
            shifts.push(new Shift(1, "John", "Cook", date, month));
            renderCalendar(currentMonth, currentYear);
        }
    }

    function renderCalendar(month, year) {
        const monthYearHeader = document.getElementById("monthYear");
        monthYearHeader.children[1].innerHTML = `${months[month]} ${year}`;

        const startDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        let calendarBody = document.getElementById("calendarBody");
        calendarBody.innerHTML = ""; // Clear the previous cells

        let numRows = Math.ceil((startDay + daysInMonth)/7);

        let date = 1;
        for (let i = 0; i < numRows; i++) {
            let row = document.createElement("tr");

            for (let j = 0; j < 7; j++) {
                let cell = document.createElement("td");
                if (i === 0 && j < startDay || date > daysInMonth) {
                    cell.innerHTML = "";
                } else if (date <= daysInMonth) {
                    if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        cell.classList.add("highlight");
                    }
                    cell.dataset.date = JSON.stringify(date);
                    cell.dataset.month = JSON.stringify(month);

                    let numShifts = 0;
                    for (let i = 0; i < shifts.length; i++) {
                        if (shifts[i].date === date && shifts[i].month == month) {
                            let cellShift = shifts[i];
                            cell.dataset.cellshift = JSON.stringify(cellShift);
                            numShifts++;
                        }
                    }
                    cell.innerHTML = `<span class="date-number">${date}</span><span class="num-shifts">${numShifts}</span>`;
                    date++;
                }
                cell.addEventListener('click', function() {
                    let cells = document.getElementsByTagName('td');
                    for (let k = 0; k < cells.length; k++) {
                        cells[k].classList.remove('selected');
                    }
                    cell.classList.add("selected");
                    
                });
                row.appendChild(cell);
            }
            calendarBody.appendChild(row); // Append each row to the calendar body
        }
    }

    class Shift {
        constructor(shiftType, employeeName, role, date, month) {
            this.shiftType = shiftType;
            this.employeeName = employeeName;
            this.role = role;
            this.date = date;
            this.month = month;
        }
    }

    
</script>
{% endblock %}


const tbody = document.getElementByID('calendarBody');
tbody.addEventListener('click', function (e) { // https://stackoverflow.com/questions/62259233/javascript-get-table-cell-content-on-click
    const cell = e.target.closest('td');
    if (!cell) {return;} // Quit, not clicked on a cell
    const row = cell.parentElement;
    cell.innerHTML = "";
});